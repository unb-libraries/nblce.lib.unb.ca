language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - echo "$DOCKER_CLOUD_USER_PASS" | docker login --username "$DOCKER_CLOUD_USER_NAME" --password-stdin
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH
  - vendor/unb-libraries/dockworker/scripts/travis/notifyNewRelicDeployment.sh

notifications:
  slack:
    rooms:
      secure: ssirEE+WmRz1X2x1lDQvfQcZbORoYa2EHGfVwdSI2DexljZ2j99WLy12I4QU+24En6iyO5+VJVCvFZb80j2Hpvrm7lkzJi9ovLcuOR6H602ZJV9qLI+zZlbtujx6I6XyU0AmHEb1NM8di5K7eKhOK7LKiOiyD2xgIKYw3eZnWuWDRPqEuQrUcQ10UpfFZvZQzSO0a7nWx4nhY9d0qO4L/a9BxJJoH9zEEeLwxPiInabAuD92eAPcV3HbgE32s43Ugg9mQpI/izvLNk9Sxi022eaoY8IWvoJ+i/mer9nNP8zBhh/1T1mnob3tow2/sONDfstQFG8m8tqIZrbYEljJapivZrzDPSRiYdGH++nzCKqKU4fe6BRpPazvm3iqy0NdIwj4GQSfTE99tlpJso6v/9wg/WcCnXlu4xZjsGOYrBRS6UQ3fBa2SeXe+kFpxKlCj58kKRAoIlRZZmVXqsDoV5bgwEnrXs3uI5v/Tsdz3d01ajk/g8fub7u7wnmaRpi0cg+nY9smvaEtYjlyetvmj1uVpSOa5slFtwrzwCp5vjv72QnPFO2WiLSJ8txhAPuXrudiaePIbeGvBBPtLMMUemARw7tHBkBfqPyNsb+hJ4UdDHDh8J5TeGymWtZ21NGn1HR5SSoY/9b0LAhlfqHtW0vsJKJfcTGFcs/yBWoS3MQ=
    on_start: always
    on_success: always
